# Use the official Node.js Alpine image
FROM node:22-alpine

# Set working directory
WORKDIR /app

# Copy package files first for better layer caching
COPY package.json ./

# Enable pnpm (corepack is already enabled in Node.js 22)
RUN corepack enable && corepack prepare pnpm@latest --activate

# Install all dependencies (including dev dependencies)
RUN pnpm install

# Copy source code
COPY . .

# Copy staging environment file if it exists (for production builds)
RUN if [ -f .env.staging ]; then cp .env.staging .env; fi

# Expose the port
EXPOSE 8082

# Set Node.js options for performance
ENV NODE_OPTIONS="--max-old-space-size=2048 --enable-source-maps"


# Start in development mode with hot reloading
CMD ["pnpm", "run", "dev"]
